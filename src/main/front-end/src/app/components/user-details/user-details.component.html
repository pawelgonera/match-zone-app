
<div class="text-center" *ngIf="!isReadyToDisplay">
  <div class="spinner-border custom-spinner" role="status"></div>
</div>

<div class="container" *ngIf="isReadyToDisplay">

  <div class="col-sm-12">

    <div class="container">

      <div class="row my-2">

        <div class="col-lg-8 order-lg-2 shadow-sm">

          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a href="" data-target="#profile" data-toggle="tab" class="nav-link active">Profile</a>
            </li>
            <li class="nav-item">
              <a href="" data-target="#messages" data-toggle="tab" class="nav-link">Messages</a>
            </li>
            <li class="nav-item">
              <a href="" data-target="#gallery" data-toggle="tab" class="nav-link">Gallery</a>
            </li>
            <li class="nav-item" *ngIf="allowAccess">
              <a href="" data-target="#edit" data-toggle="tab" class="nav-link">Edit</a>
            </li>
          </ul>

          <div class="tab-content py-4">
            <div class="tab-pane active" id="profile">
              <h5 class="mb-3">User Profile</h5>
              <br>
              <div class="row">
                <div class="col-md-6">
                  <h6>About</h6>
                  <hr>
                  <p>{{appearance.about}}</p>
                  <h6>Hobbies</h6>
                  <hr>
                  <p>{{appearance.hobbies}}</p>
                </div>
                <div class="col-md-6">
                  <h6>Appearance</h6>
                  <hr>
                  <b>Eyes: </b> {{appearance.eyes}}
                  <br>
                  <b>Hair colour: </b> {{appearance.hairColour}}
                  <br>
                  <b>Height: </b> {{appearance.height}} cm
                  <br>
                  <b>Physique: </b> {{appearance.physique}}
                  <br>
                  <br>
                  <h6>Other</h6>
                  <hr>
                  <b>Country: </b> {{personalDetails.country}}
                  <br>
                  <b>City: </b> {{personalDetails.city}}
                  <br>
                  <b>Occupation: </b> {{personalDetails.occupation}}
                  <br>
                  <b>Marital status: </b> {{personalDetails.maritalStatus}}
                  <br>
                  <b>Education: </b> {{personalDetails.education}}
                  <br>
                  <b>Religion: </b> {{personalDetails.religion}}

                </div>

              </div><!-- end of row -->

            </div><!-- end of tab-pane -->

            <div class="tab-pane" id="messages">
              <div class="alert alert-info alert-dismissable text-center">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">Ã—</a>
                This is an <strong>alert</strong>. Use this to show important messages to the user.
              </div>

              <div  *ngIf="comments">

                <div class="col-md-12" *ngFor="let comment of comments">
                  <div class="card mb-3 shadow-sm" style="max-width:800px; max-height: 200px">
                    <div class="row no-gutters">
                      <div class="col-md-2 avatar">
                        <img src="data:image/png;base64,{{comment.avatar}}" class="mx-auto img-fluid img-circle d-block shadow img-radius" alt="avatar">
                        <p  class="text-center"><small><b>{{comment.author}}</b></small></p>
                      </div>
                      <div class="col-md-10">
                        <div class="card-body">
                          <p class="card-text"><strong *ngIf="postId != comment.id">{{comment.content}}</strong></p>

                          <div *ngIf="postId == comment.id">
                            <form name="form-signin" (ngSubmit)="editComment(comment)" #form="ngForm">

                              <mat-form-field class="edit-input">
                                <mat-label>Edit post</mat-label>
                                <textarea matInput cdkTextareaAutosize cdkAutosizeMinRows="2" cdkAutosizeMaxRows="3" [(ngModel)]="comment.content" name="content"></textarea>
                                <hr>
                                <button class="btn btn-pink-edit text-center">Edit</button>
                              </mat-form-field>

                            </form>
                          </div>

                          <hr>
                          <p>
                            <small class="text-muted">{{ comment.postDate | date : 'yyyy/MMMM/dd, HH:mm:ss' }}</small>
                            <span *ngIf="postId != comment.id && comment.author == usernameFromToken" class="card-text">
                              <a class="btn-edit-comm" (click)="editPost(comment.id)" ><mat-icon class="fa fa-edit">edit</mat-icon ></a>
                              <a class="btn-delete-comm" (click)="deleteComment(comment.id)" ><mat-icon class="fa fa-trash">delete</mat-icon ></a>
                            </span>
                          </p>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>

              <hr>

              <div  *ngIf="!allowAccess">

                <form name="form-signin" (ngSubmit)="addComment(form)" #form="ngForm">

                  <mat-form-field class="edit-input">
                    <mat-label>Post new comment</mat-label>
                    <textarea matInput cdkTextareaAutosize cdkAutosizeMinRows="2" cdkAutosizeMaxRows="4" [(ngModel)]="comment.content" name="content"></textarea>
                  </mat-form-field>

                  <!--<label for="PostNewComment">Post new comment</label>
                  <textarea class="form-control" id="PostNewComment" rows="3" [(ngModel)]="comment.content" name="content" placeholder="Type a comment" [maxLength]="250"></textarea>-->

                  <button class="btn btn-pink">Post</button>

                </form>

              </div>

            </div>

            <div class="tab-pane" id="gallery">

              <!--Carousel Wrapper-->
              <div id="carousel-example-2" class="carousel slide carousel-fade z-depth-1-half shadow" data-interval="false" data-ride="carousel" *ngIf="images">
                <!--Indicators-->
                <ol class="carousel-indicators">
                  <!--<li data-target="#carousel-example-2" *ngFor="let image of images;index as i;first as isfirst" data-slide-to="i" [ngClass]="{'active':isfirst}"></li>-->
                  <!--<li data-target="#carousel-example-2" data-slide-to="1"></li>
                  <li data-target="#carousel-example-2" data-slide-to="2"></li>-->
                </ol>
                <!--/.Indicators-->
                <!--Slides-->

                <div class="carousel-inner" style="background-color: white" role="listbox">

                  <div class="carousel-item" *ngFor="let image of images let i = index" [ngClass]="{'active' : i == 0}">
                    <div class="view">
                      <img class="d-block w-100" src="data:image/png;base64,{{image.photo}}" alt="{{image.title}}">
                      <!--<div class="mask rgba-black-light"></div>-->
                    </div>
                    <div class="carousel-caption">
                      <h3 class="h3-responsive" *ngIf="photoId != image.id">{{image.title}}</h3>

                      <div *ngIf="photoId == image.id">
                        <form name="form-signin" (ngSubmit)="editTitle(image)" #form="ngForm">

                          <mat-form-field class="edit-input">
                            <mat-label>Edit title</mat-label>
                            <input type="text" matInput [(ngModel)]="image.title" name="title" required>
                            <hr>
                            <button class="btn btn-pink-edit text-center">Edit</button>
                          </mat-form-field>

                        </form>
                      </div>

                    </div>
                    <a class="btn-edit-photo" (click)="editPhoto(image.id)" ><mat-icon class="fa fa-edit">edit title</mat-icon ></a>
                    <a class="btn-delete-photo" (click)="deletePhoto(image.id)" ><mat-icon class="fa fa-trash">delete</mat-icon ></a>
                  </div>

                </div>
                <!--/.Slides-->
                <!--Controls-->
                <a class="carousel-control-prev" href="#carousel-example-2" role="button" data-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carousel-example-2" role="button" data-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="sr-only">Next</span>
                </a>
                <!--/.Controls-->
              </div>
              <!--/.Carousel Wrapper-->

              <div *ngIf="allowAccess">

                  <mat-form-field style="margin-left: 250px">
                    <mat-label>Add title</mat-label>
                    <input type="text" matInput [(ngModel)]="title" name="title">
                  </mat-form-field>

                <label for="Photo" class="col-form-label form-control-label" style="margin-left: 270px">
                  <!--<input type="file" id="Photo" class="custom-file-input" (change)="onFileSelected($event)">-->
                  <button class="btn btn-primary" id="Photo" (click)="uploadFile()">Add images</button>
                  <!--<span class="custom-file-control btn btn-primary">Add images</span>-->
                </label>

                <div style="margin-left: 8px">
                  <div *ngIf="photoUploadProgress">
                    Upload progress: {{ photoUploadProgress }}
                    <mat-progress-bar mode="determinate" [value]="photoUploadProgress"></mat-progress-bar>
                  </div>
                  <div class="alert alert-danger text-center" *ngIf="photoErrorMessage">
                    {{ photoErrorMessage }}
                  </div>
                </div>

                  <button type="button" class="btn btn-success" style="margin-left: 293px" [disabled]="!image" (click)="onGalleryUpload()">Upload</button>

              </div>

            </div>

            <div class="tab-pane" id="edit">
              <form (ngSubmit)="onSubmit()">
                <h4 class="text-center">Personal details</h4>
                <div class="form-group row">
                  <label for="FirstName" class="col-lg-3 col-form-label form-control-label">First Name</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="FirstName" type="text" required [(ngModel)]="user.firstName" name="firstName">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Email" class="col-lg-3 col-form-label form-control-label">Email</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="Email" type="email" required [(ngModel)]="user.email" name="email">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="DateOfBirth" class="col-lg-3 col-form-label form-control-label">Date Of Birth</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="DateOfBirth" type="date" required [(ngModel)]="personalDetails.dateOfBirth" name="dateOfBirth">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Gender" class="col-lg-3 col-form-label form-control-label">Gender</label>
                  <div class="col-lg-9">
                    <select id="Gender" class="form-control" size="0" [(ngModel)]="personalDetails.gender" name="gender">
                      <option value="MALE">Male</option>
                      <option value="FEMALE">Female</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Country" class="col-lg-3 col-form-label form-control-label">Country</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="Country" type="text" required [(ngModel)]="personalDetails.country" name="country">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="City" class="col-lg-3 col-form-label form-control-label">City</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="City" type="text" required [(ngModel)]="personalDetails.city" name="city">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Occupation" class="col-lg-3 col-form-label form-control-label">Occupation</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="Occupation" type="text" [(ngModel)]="personalDetails.occupation" name="occupation">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="MaritalStatus" class="col-lg-3 col-form-label form-control-label">Marital status</label>
                  <div class="col-lg-9">
                    <select id="MaritalStatus" class="form-control" size="0" [(ngModel)]="personalDetails.maritalStatus" name="maritalStatus">
                      <option value="MARRIED">Married</option>
                      <option value="WIDOWED">Widowed</option>
                      <option value="SEPARATED">Separated</option>
                      <option value="DIVORCED">Divorced</option>
                      <option value="SINGLE">Single</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Education" class="col-lg-3 col-form-label form-control-label">Education</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="Education" type="text" [(ngModel)]="personalDetails.education" name="education">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Religion" class="col-lg-3 col-form-label form-control-label">Religion</label>
                  <div class="col-lg-9">
                    <select id="Religion" class="form-control" size="0" [(ngModel)]="personalDetails.religion" name="religion">
                      <option value="CHRISTIANITY">Christianity</option>
                      <option value="ISLAM">Islam</option>
                      <option value="HINDUISM">Hinduism</option>
                      <option value="BUDDHISM">Buddhism</option>
                      <option value="JUDAISM">Judaism</option>
                      <option value="ATHEIST">Atheist</option>
                    </select>
                  </div>
                </div>
                <br>
                <h4 class="text-center">Appearance</h4>
                <div class="form-group row">
                  <label for="Eyes" class="col-lg-3 col-form-label form-control-label">Eyes</label>
                  <div class="col-lg-9">
                    <select id="Eyes" class="form-control" size="0" [(ngModel)]="appearance.eyes" name="eyes">
                      <option value="BLUE">Blue</option>
                      <option value="BROWN">Brown</option>
                      <option value="GREEN">Green</option>
                      <option value="HAZEL ">Hazel</option>
                      <option value="GREY">Grey</option>
                      <option value="AMBER">Amber</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="HairColour" class="col-lg-3 col-form-label form-control-label">Hair colour</label>
                  <div class="col-lg-9">
                    <select id="HairColour" class="form-control" size="0" [(ngModel)]="appearance.hairColour" name="hairColour">
                      <option value="BLACK">Black</option>
                      <option value="DARK_BROWN">Dark brown</option>
                      <option value="LIGHT_BROWN">Light brown</option>
                      <option value="BROWN">Brown</option>
                      <option value="DARK_BLONDE">Dark blonde</option>
                      <option value="LIGHT_BLONDE">Light blonde</option>
                      <option value="BLONDE">Blonde</option>
                      <option value="GINGER_RED">Ginger red</option>
                      <option value="GREY">Grey</option>
                      <option value="WHITE">White</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Height" class="col-lg-3 col-form-label form-control-label">Height</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="Height" type="number" min="140" max="210" [(ngModel)]="appearance.height" name="height">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Physique" class="col-lg-3 col-form-label form-control-label">Physique</label>
                  <div class="col-lg-9">
                    <select id="Physique" class="form-control" size="0" [(ngModel)]="appearance.physique" name="physique">
                      <option value="SKINNY">Skinny</option>
                      <option value="SLIM">Slim</option>
                      <option value="NORMAL">Normal</option>
                      <option value="SHAPELY">Shapely</option>
                      <option value="MUSCULAR">Muscular</option>
                      <option value="THICK">Thick</option>
                      <option value="FAT">Fat</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="WriteAboutYourself">Write about yourself</label>
                  <textarea class="form-control" id="WriteAboutYourself" rows="3" [(ngModel)]="appearance.about" name="about" placeholder="Max 500 signs" [maxLength]="500"></textarea>
                </div>
                <div class="form-group">
                  <label for="Hobbies">Hobbies</label>
                  <textarea class="form-control" id="Hobbies" rows="3" [(ngModel)]="appearance.hobbies" name="hobbies" placeholder="Max 256 signs" [maxLength]="256"></textarea>
                </div>
                <br><br>

                <div class="form-group row">
                  <label class="col-lg-3 col-form-label form-control-label"></label>
                  <div class="col-lg-9">
                    <input type="reset" class="btn btn-secondary" value="Cancel">
                    <input type="submit" class="btn btn-primary" value="Save Changes">
                  </div>
                </div>

              </form>

              <br><br>

              <form (ngSubmit)="f.form.valid && onSubmit()" #f="ngForm">

                <h4 class="text-center">Account details</h4>
                <div class="form-group row">
                  <label for="TimeZone" class="col-lg-3 col-form-label form-control-label">Time Zone</label>
                  <div class="col-lg-9">
                    <select id="TimeZone" class="form-control" size="0" [(ngModel)]="user.timeZoneId" name="timeZoneId">
                      <option value="US/Hawaii">(GMT-10:00) Hawaii</option>
                      <option value="US/Alaska">(GMT-09:00) Alaska</option>
                      <option value="Canada/Pacific">(GMT-08:00) Pacific Time (US &amp; Canada)</option>
                      <option value="US/Arizona">(GMT-07:00) Arizona</option>
                      <option value="US/Mountain">(GMT-07:00) Mountain Time (US &amp; Canada)</option>
                      <option value="US/Central">(GMT-06:00) Central Time (US &amp; Canada)</option>
                      <option value="Canada/Eastern">(GMT-05:00) Eastern Time (US &amp; Canada)</option>
                      <option value="US/East-Indiana">(GMT-05:00) Indiana (East)</option>
                      <option value="Canada/Atlantic">(GMT-04:00) Atlantic Standard Time (Canada)</option>
                      <option value="America/Argentina">(GMT-03:00) Argentina Time</option>
                      <option value="Atlantic/Azores">(GMT-02:00) Azores Time</option>
                      <option value="West Africa Time">(GMT-01:00) West Africa Time</option>
                      <option value="Etc/Greenwich">(GMT-00:00) Greenwich Time (ETC)</option>
                      <option value="Europe/Warsaw" selected="selected">(GMT+01:00) Central European Time (Warsaw)</option>
                      <option value="Europe/Kaliningrad">(GMT+02:00) Eastern European Time (Kaliningrad)</option>
                      <option value="Europe/Moscow">(GMT+03:00) Moscow Time</option>
                      <option value="Europe/Samara">(GMT+04:00) Samara, Armenia, Azerbaidjan, Georgia, Mauritius Times</option>
                      <option value="Pakistan Standard Time">(GMT+05:00) Pakistan Standard Time</option>
                      <option value="Bangladesh Standard Time">(GMT+06:00) Bangladesh Standard Time</option>
                      <option value="Christmas Island Time (Australia)">(GMT+07:00) Christmas Island Time (Australia)</option>
                      <option value="China Standard Time">(GMT+08:00) China Standard Time</option>
                      <option value="Japan">(GMT+09:00) Japan Standard Time</option>
                      <option value="East Australian Standard Time">(GMT+10:00) East Australian Standard Time</option>
                      <option value="Asia/Sakhalin">(GMT+11:00) Sakhalin Time</option>
                      <option value="New Zealand Standard Time">(GMT+12:00) New Zealand Standard Time</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Username" class="col-lg-3 col-form-label form-control-label">Username</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="Username" type="text" required [(ngModel)]="user.username" #username="ngModel" name="username">
                    <div class="alert alert-danger" *ngIf="f.submitted && username.invalid">
                      <div *ngIf="username.errors.required">UserName is required</div>
                    </div>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="Password" class="col-lg-3 col-form-label form-control-label">Password</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="Password" type="password" required [(ngModel)]="user.password" #password="ngModel" name="password" minlength="6">
                    <div class="alert alert-danger" *ngIf="f.submitted && password.invalid">
                      <div *ngIf="password.errors.required">Password is required</div>
                      <div *ngIf="password.errors.minlength">Password must be at least 6 characters</div>
                    </div>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="ConfirmPassword" class="col-lg-3 col-form-label form-control-label">Confirm password</label>
                  <div class="col-lg-9">
                    <input class="form-control" id="ConfirmPassword" type="password" required [(ngModel)]="user.repeatedPassword" name="repeatedPassword" #repeatedPassword="ngModel">
                    <div class="alert alert-danger" *ngIf="f.submitted && repeatedPassword.invalid">
                      <div *ngIf="repeatedPassword.errors.required">Password is required</div>
                      <div *ngIf="repeatedPassword.errors.minlength">Password must be at least 6 characters</div>
                    </div>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-lg-3 col-form-label form-control-label"></label>
                  <div class="col-lg-9">
                    <input type="reset" class="btn btn-secondary" value="Cancel">
                    <input type="submit" class="btn btn-danger" value="Change Account Data">
                  </div>
                  <div *ngIf="f.submitted && isChangeDataFailed" class="alert alert-danger">
                    Changing data failed!<br/>{{errorMessage}}
                  </div>
                </div>

              </form>

            </div><!-- end of tab-pane -->

          </div><!-- end of tab-content -->

        </div><!-- end of col-lg-8 -->

        <div class="col-lg-4 order-lg-1 text-center">

          <div class="text-center" *ngIf="!croppedImage">
            <div class="spinner-border custom-spinner" role="status"></div>
          </div>

          <image-cropper *ngIf="imageChangedEvent"
            [imageChangedEvent]="imageChangedEvent"
            [maintainAspectRatio]="true"
            [aspectRatio]="1 / 1"
            [resizeToWidth]="256"
            [format]="png"
            (imageCropped)="imageCropped($event)"
            (loadImageFailed)="loadImageFailed()"
          ></image-cropper>

          <!--<img [src]="croppedImage" />-->

          <img *ngIf="personalDetails.photo" src="data:image/png;base64,{{personalDetails.photo}}" class="shadow" alt="avatar">
          <h6 class="mt-2">{{user.firstName}}, {{personalDetails.age}} years old</h6>

          <br>

          <div *ngIf="allowAccess">

            <label for="File" class=" col-form-label form-control-label">
              <input type="file" id="File" class="custom-file-input" (change)="onAvatarSelected($event)">
              <span class="custom-file-control btn btn-primary">Change avatar</span>
            </label>
            <div *ngIf="avatarUploadProgress">
              Upload progress: {{ avatarUploadProgress }}
              <mat-progress-bar mode="determinate" [value]="avatarUploadProgress"></mat-progress-bar>
            </div>
            <div class="alert alert-danger" *ngIf="avatarErrorMessage">
              {{ avatarErrorMessage }}
            </div>
            <button type="button" class="btn btn-success" [disabled]="!croppedImage" (click)="onUpload()">Upload</button>

            <h3>Rate</h3>
            <hr>
            <h1>{{personalDetails.rating | number: '1.1-1'}}</h1>

          </div>

          <div *ngIf="!allowAccess">
            <h3>Rate</h3>
            <hr>
            <h1>{{personalDetails.rating  | number: '1.1-1'}}</h1>
          </div>

          <div *ngIf="isLogged && !isVoted && !allowAccess">
            <ngb-rating [(rate)]="currentRate" max="6" >
              <ng-template let-fill="fill" let-index="index" >
                  <span class="star" [class.filled]="fill === 100"
                        [class.star-size-0]="index == 0" [class.star-size-1]="index == 1" [class.star-size-2]="index == 2" [class.star-size-3]="index == 3"
                        [class.star-size-4]="index == 4" [class.star-size-5]="index == 5">&#9733;</span>
              </ng-template>
            </ngb-rating>
            <hr>
            <button type="button" class="btn btn-success" (click)="onVote(vote)">Vote</button>
            <pre class="text-right">Rate: <b> {{vote.value}} </b></pre>
          </div>

        </div><!-- end of col-lg-4 -->

      </div><!-- end of row -->

    </div><!-- end of container -->

  </div><!-- end of col-sm-12 -->

</div><!-- end of container main -->
